J$VM = new function () {this.__product__ = "J$VM";this.__version__ = "0.9.s23e7d150c18c4031";this.env = {j$vm_log:false, j$vm_ajax_nocache:true, j$vm_ajax_timeout:600000, j$vm_timeslice:20, j$vm_threshold:45, j$vm_longpress:90};this.env.j$vm_isworker = function () {try {return (window) ? false : true;}catch (x) {return true;}}();js = {lang:{}};Function.prototype.$extend = function (superC) {if (typeof superC === "function") {var proto = this.prototype = new (superC)();proto.constructor = superC;} else {if (typeof superC === "object") {var proto = this.prototype = superC;proto.constructor = superC.constructor;} else {throw new Error("superC must be a function or object");}}return this;};Function.prototype.$implements = function (superCs) {var proto = this.prototype, superC;proto.__imps__ = proto.__imps__ || [];for (var i = 0, len = arguments.length; i < len; i++) {superC = arguments[i];if (typeof superC != "function") {continue;}proto.__imps__.push(superC);superC.$decorate(proto);}return this;};Function.prototype.$decorate = function (o) {var p, proto = this.prototype;if (this.__defined__ == undefined) {new (this)();}for (p in proto) {if (proto.hasOwnProperty(p) && "constructor" != p && !o.hasOwnProperty(p)) {o[p] = proto[p];}}return o;};Function.prototype.$bind = function (thi$) {var fn = this, args = Array.prototype.slice.call(arguments, 1);return function () {var $args = args.slice(0);$args = Array.prototype.slice.call(arguments, 0).concat($args);return fn.apply(thi$, $args);};};Function.prototype.$listen = function (thi$, eClass) {var fn = this, args = Array.prototype.slice.call(arguments, 2);var agent = function (e) {var $args = args.slice(0);var _e = (typeof eClass === "function") ? new (eClass)(e) : e;$args.unshift(_e);return fn.apply(thi$, $args);};agent.__host__ = fn;return agent;};Function.prototype.$delay = function (thi$, timeout) {var fn = this, args = Array.prototype.slice.call(arguments, 2);fn.__timer__ = fn.__timer__ || [];fn.__timer__.push(setTimeout(function () {fn.$clearTimer();fn.apply(thi$, args);}, timeout));return fn.__timer__[fn.__timer__.length - 1];};Function.prototype.$clearTimer = function (timer) {var timers = this.__timer__, index = -1, ret = false;if (timers && timers.length > 0) {if (timer != undefined && timer != null) {for (var i = 0, len = timers.length; i < len; i++) {if (timers[i] === timer) {index = i;break;}}if (index != -1) {timers.splice(index, 1);clearTimeout(timer);ret = true;}} else {clearTimeout(timers.shift());ret = true;}}return ret;};Function.prototype.$override = function (func) {this.__super__ = func;return this;};Function.prototype.$forEach = function (thi$, set) {var fn = this, i, len, $args = Array.prototype.slice.call(arguments, 2);switch (js.lang.Class.typeOf(set)) {case "array":for (i = 0, len = set.length; i < len; i++) {try {fn.apply(thi$, $args.concat(set[i], i, set));}catch (x) {if ("break" === x) {break;}}}break;case "object":for (i in set) {try {fn.apply(thi$, $args.concat(set[i], i, set));}catch (x) {if ("break" === x) {break;}}}break;default:break;}};Function.prototype.$map = function (thi$, set) {var fn = this, ret = js.lang.Class.isArray(set) ? [] : {}, $args = Array.prototype.slice.call(arguments, 2);(function (v, i, set) {ret[i] = fn.apply(thi$, $args.concat(v, i, set));}).$forEach(thi$, set);return ret;};Function.prototype.$filter = function (thi$, set) {var fn = this, isArray = js.lang.Class.isArray(set), ret = isArray ? [] : {}, $args = Array.prototype.slice.call(arguments, 2);(function (v, i, set) {if (fn.apply(thi$, $args.concat(v, i, set))) {isArray ? ret.push(v) : ret[i] = v;}}).$forEach(thi$, set);return ret;};Function.prototype.$some = function (thi$, set) {var fn = this, ret = false, $args = Array.prototype.slice.call(arguments, 2);(function (v, i, set) {if (fn.apply(thi$, $args.concat(v, i, set))) {ret = true;throw "break";}}).$forEach(thi$, set);return ret;};Function.prototype.$every = function (thi$, set) {var fn = this, ret = true, $args = Array.prototype.slice(arguments, 2);(function (v, i, set) {if (fn.apply(thi$, $args.concat(v, i, set))) {ret = false;throw "break";}}).$forEach(thi$, set);return ret;};}();js.lang.Class = new function () {var _modules = {};this.definePackage = function (packageName) {if (_modules[packageName]) {return;}var names = packageName.split(".");var parent = self;for (var i = 0, len = names.length; i < len; i++) {var name = names[i];if (parent[name] === undefined) {parent[name] = {};}parent = parent[name];}_modules[packageName] = parent;};this.importClass = function (className) {var clazz = _checkClass(className);if (clazz != undefined) {return clazz;}var buf = [];buf.push(J$VM.env.j$vm_home);buf.push("/classes");var names = className.split(".");for (var i = 0, len = names.length; i < len; i++) {buf.push("/");buf.push(names[i]);}buf.push(".jz");var filePath = buf.join("");try {_loadClass(filePath, className);clazz = _modules[className] = _checkClass(className);}catch (ex) {J$VM.System.err.println("Can't load " + className + " from " + filePath);}return clazz;};var _checkClass = function (className) {var clazz = _modules[className];if (clazz === undefined) {var names = className.split(".");clazz = self;for (var i = 0, len = names.length; i < len; i++) {var name = names[i];if (clazz[name] === undefined) {clazz = undefined;break;}clazz = clazz[name];}_modules[className] = clazz;}return clazz;}.$bind(this);this.loadClass = function (filePath) {try {_loadClass(filePath);}catch (ex) {J$VM.System.err.println("Can't load class from " + filePath);}};var _loadClass = function (filePath, className) {if (!J$VM.env.j$vm_isworker) {var storage = J$VM.storage.local, text, incache = false, cached = storage.getItem(className || filePath);if (cached) {if (cached.build === J$VM.__version__) {text = cached.text;incache = true;}}text = text || this.getResource(filePath);this.loadScript(filePath, text);if (!incache) {try {storage.setItem(className || filePath, {build:J$VM.__version__, text:text});}catch (x) {J$VM.System.err.println(x);}}} else {importScripts(filePath);}}.$bind(this);this.loadScript = function (filePath, text) {text = text || this.getResource(filePath);var script = document.createElement("script");var head = document.getElementsByTagName("head")[0];script.type = "text/javascript";script.text = text;head.appendChild(script);head.removeChild(script);}.$bind(this);this.getResource = function (url) {var xhr = new js.net.HttpURLConnection(false);xhr.open("GET", url);if (xhr.exception == undefined && xhr.readyState() == 4 && (xhr.status() == 200 || xhr.status() == 304)) {var text = xhr.responseText();xhr.close();return text;}var ex = xhr.exception;xhr.close();throw ex;}.$bind(this);this.forName = function (className) {var clazz = _checkClass(className);if (clazz === undefined) {clazz = this.importClass(className);}return clazz;}.$bind(this);this.typeOf = function (o) {return (o === null) ? "null" : (o === undefined) ? "undefined" : this.isHtmlElement(o) ? "html" + o.tagName.toLowerCase() + "element" : (function () {var s = Object.prototype.toString.call(o);return s.substring(8, s.length - 1).toLowerCase();})();}.$bind(this);this.isDate = function (o) {return (this.typeOf(o) == "date" && !isNaN(o));};this.isArray = function (o) {return this.typeOf(o) === "array";};this.isString = function (o) {return this.typeOf(o) == "string";};this.isNumber = function (o) {return !isNaN(o) && this.typeOf(o) == "number";};this.isObject = function (o) {return this.typeOf(o) == "object";};this.isBoolean = function (o) {return this.typeOf(o) == "boolean";};this.isNull = function (o) {return this.typeOf(o) == "null";};this.isUndefined = function (o) {return this.typeOf(o) == "undefined";};this.isFunction = function (o) {return this.typeOf(o) == "function";};this.isValid = function (o) {return (o != null) && (o != undefined);};this.isHtmlElement = function (o) {return o ? !!o.tagName : false;};this.isJSON = function (str) {if (!this.isString(str) || str.length == 0) {return false;}try {var obj = JSON.parse(str);return true;}catch (e) {return false;}};this.is = function (o, type) {if (!type) {return o !== undefined && o !== null;}var b = false;type = type.toLowerCase();switch (type) {case "number":b = this.isNumber(o);break;case "date":b = this.isDate(o);break;default:b = (this.typeOf(o) === type);break;}return b;};}();$package = js.lang.Class.definePackage;$import = js.lang.Class.importClass;js.lang.Math = new function () {var count = 0;this.random = function (n) {return n ? Math.floor(Math.random() * n + 1) : Math.random();};this.uuid = function (hash) {hash = hash || (new Date().getTime() + count++);return "s" + hash.toString(16);};}();js.lang.Object = function (o) {var CLASS = js.lang.Object, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;thi$.hashCode = function () {if (this._hash == undefined) {this._hash = js.lang.Math.random(new Date().getTime());}return this._hash;};thi$.equals = function (o) {return o === this;};thi$.toString = function () {return (typeof this) + "@" + this.uuid();};thi$.uuid = function (id) {if (id !== undefined) {this._uuid = id;} else {if (this._uuid == undefined) {this._uuid = js.lang.Math.uuid(this.hashCode());}}return this._uuid;};thi$.instanceOf = function (clazz) {if (this.__imps__) {for (var i = 0, len = this.__imps__.length; i < len; i++) {if (clazz === this.__imps__[i]) {return true;}}}return this instanceof clazz;};thi$.destroy = function () {J$VM.MQ.remove(this.uuid());};}.$extend(Object);js.lang.String = new function () {var REGX_HTML_ENCODE = /"|&|'|<|>|[\x00-\x20]|[\x7F-\xFF]|[\u0100-\u2700]/g;var REGX_HTML_DECODE = /&\w+;|&#(\d+);|<br\/>/g;var REGX_TRIM = /(^\s*)|(\s*$)/g;var REGX_REGEXP_METACHARS = /[\^\$\.\*\+\?\|\\\(\)\[\]\{\}]/g;var REGX_REGEXP_ESCAPEDMETACHARS = /\\([\^\$\.\*\+\?\|\\\(\)\[\]\{\}])/g;var HTML_DECODE = {"&lt;":"<", "&gt;":">", "&amp;":"&", "&nbsp;":" ", "&quot;":"\"", "&copy;":"\xa9", "<br/>":String.fromCharCode(10)};this.encodeHtml = String.prototype.encodeHtml = function (s, nobreak) {s = (s != undefined) ? s : this.toString();return (typeof s != "string") ? s : s.replace(REGX_HTML_ENCODE, function ($0) {var c = $0.charCodeAt(0), r = ["&#"];if (c == 13 || c == 10) {if (nobreak !== true) {return "<br/>";}}c = (c == 32) ? 160 : c;r.push(c);r.push(";");return r.join("");});};this.decodeHtml = String.prototype.decodeHtml = function (s, nobreak) {s = (s != undefined) ? s : this.toString();return (typeof s != "string") ? s : s.replace(REGX_HTML_DECODE, function ($0, $1) {var c = HTML_DECODE[$0];if (c == undefined) {if (!isNaN($1)) {c = String.fromCharCode(($1 == 160) ? 32 : $1);} else {c = $0;}}return c;});};this.escapeRegExp = String.prototype.escapeRegExp = function (s) {s = (s != undefined) ? s : this.toString();return (typeof s != "string") ? s : s.replace(REGX_REGEXP_METACHARS, function ($0) {return "\\" + $0;});};this.unescapeRegExp = String.prototype.unescapeRegExp = function (s) {s = (s != undefined) ? s : this.toString();return (typeof s != "string") ? s : s.replace(REGX_REGEXP_ESCAPEDMETACHARS, function ($0, ch) {return ch;});};this.trim = String.prototype.trim = function (s) {s = (s != undefined) ? s : this.toString();return (typeof s != "string") ? s : s.replace(REGX_TRIM, "");};String.prototype.hashCode = function () {var hash = this._hash, _char;if (hash == undefined || hash == 0) {hash = 0;for (var i = 0, len = this.length; i < len; i++) {_char = this.charCodeAt(i);hash = 31 * hash + _char;hash = hash & hash;}hash = hash & 2147483647;this._hash = hash;}return this._hash;};}();js.lang.StringBuffer = function (s) {var CLASS = js.lang.StringBuffer, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;thi$.append = function (s) {this._buf.push(s);return this;};thi$.clear = function () {this._buf.splice(0, this._buf.length);return this;};thi$.toString = function () {return this._buf.join("");};thi$._init = function (s) {this._buf = [];if (s) {this._buf.push(s);}};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.util");js.util.LinkedList = function (array) {var CLASS = js.util.LinkedList, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init(array);return;}CLASS.__defined__ = true;thi$.getFirst = function () {if (this.length == 0) {throw new Error("NoSuchElementException");}return this[0];};thi$.getLast = function () {if (this.length == 0) {throw new Error("NoSuchElementException");}return this[this.length - 1];};thi$.addFirst = function (e) {this.add(0, e);};thi$.push = function (e) {arguments.callee.__super__.apply(this, arguments);return this;}.$override(this.push);thi$.addLast = function (e) {this.push(e);};thi$.removeFirst = function () {return this.shift();};thi$.removeLast = function () {return this.pop();};thi$.add = function (index, e) {this.splice(index, 0, e);};thi$.set = function (index, e) {var oldVal = this[index];this[index] = e;return oldVal;};thi$.get = function (index) {return this[index];};thi$.remove0 = function (index) {var e = this.get(index);this.splice(index, 1);return e;};thi$.remove = function (e) {var idx = this.indexOf(e);return (idx != -1) ? this.remove0(idx) : null;};thi$.indexOf = function (e) {for (var i = 0, len = this.length; i < len; i++) {var _e = this[i];if (e instanceof js.lang.Object && _e instanceof js.lang.Object) {if (_e.equals(e)) {return i;}} else {if (_e === e) {return i;}}}return -1;};thi$.contains = function (e) {return this.indexOf(e) != -1;};thi$.clear = function () {this.splice(0, this.length);return this;};thi$._init = function (array) {if (array && js.lang.Class.isArray(Array)) {this.addLast.$forEach(this, array);}};this._init(array);}.$extend(Array);js.util.LinkedList.newInstance = function (array) {var o = js.lang.Class.isArray(array) ? array : [];return js.util.LinkedList.$decorate(o);};$package("js.util");$import("js.util.LinkedList");js.util.HashMap = function (map) {var CLASS = js.util.HashMap, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class;thi$.put = function (key, value) {if (!Class.isString(key) && !Class.isNumber(key)) {throw "The key must be a string or number";}this._vals[key] = value;if (!this._keys.contains(key)) {this._keys.addLast(key);}};thi$.size = function () {return this._keys.length;};thi$.contains = function (key) {return this._keys.contains(key);};thi$.get = function (key) {return this._vals[key];};thi$.remove = function (key) {var e;this._keys.remove(key);e = this._vals[key];delete this._vals[key];return e;};thi$.keys = function () {var ret = [], keys = this._keys;for (var i = 0, len = keys.length; i < len; i++) {ret.push(keys[i]);}return ret;};thi$.values = function () {var ret = [], keys = this._keys, vals = this._vals;for (var i = 0, len = keys.length; i < len; i++) {ret.push(vals[keys[i]]);}return ret;};thi$.addAll = function (map) {for (var p in map) {this.put(p, map[p]);}};thi$.clear = function () {this._vals = {};this._keys = js.util.LinkedList.newInstance();};thi$._init = function (map) {this._vals = map || {};this._keys = js.util.LinkedList.newInstance();var _keys = this._keys, _vals = this._vals;for (var p in _vals) {if (_vals.hasOwnProperty(p)) {_keys.push(p);}}};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.util");js.util.Properties = function (map) {var CLASS = js.util.Properties, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;thi$.getProperty = function (key, defaultValue) {var tmp = this.get(key);return tmp == undefined ? defaultValue : tmp;};thi$.setProperty = function (key, value) {this.put(key, value);};this._init.apply(this, arguments);}.$extend(js.util.HashMap);$package("js.util");js.util.Observable = function () {var CLASS = js.util.Observable, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;thi$.addObserver = function (observer) {if (!(observer.instanceOf(js.util.Observer))) {return;}if (!this._obs.contains(observer)) {this._obs.addLast(observer);}};thi$.deleteObserver = function (observer) {if (!(observer.instanceOf(js.util.Observer))) {return;}this._obs.remove(observer);};thi$.deleteObservers = function () {this._obs.clear();};thi$.notifyObservers = function (data) {if (!this.hasChanged()) {return;}(function (observer) {observer.update.$delay(observer, 0, this, data);}).$forEach(this, this._obs);};thi$.hasChanged = function () {return this._changed;};thi$.setChanged = function () {this._changed = true;};thi$.clearChanged = function () {this._changed = false;};thi$.destroy = function () {this._obs.clear();delete this._obs;arguments.callee.__super__.apply(this, arguments);}.$override(this.destroy);thi$._init = function () {this._obs = js.util.LinkedList.$decorate([]);this._changed = false;};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.util");js.util.Observer = function () {var CLASS = js.util.Observer, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;thi$.update = function (observable, data) {};};$package("js.util");js.util.Event = function (eventType, eventData, eventTarget) {var CLASS = js.util.Event, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init(eventType, eventData, eventTarget);return;}CLASS.__defined__ = true;thi$.getType = function () {return this._type;};thi$.setType = function (type) {this._type = type;};thi$.getTimeStamp = function () {return this._time;};thi$.getData = function () {return this._data;};thi$.setData = function (data) {this._data = data;};thi$.getEventTarget = function () {return this._target;};thi$.setEventTarget = function (eventTarget) {this._target = eventTarget;};thi$._init = function (eventType, eventData, eventTarget) {this.setType(eventType);this.setData(eventData);this.setEventTarget(eventTarget);this._time = new Date();};this._init(eventType, eventData, eventTarget);}.$extend(js.lang.Object);js.util.Event.FLAG = {EXCLUSIVE:1 << 0, CAPTURED:1 << 1, CUSTOMIZED:1 << 2, check:function (f) {var o = {exclusive:false, captured:false, customized:false};if (typeof f === "number") {o.exclusive = (f & this.EXCLUSIVE) != 0;o.captured = (f & this.CAPTURED) != 0;o.customized = (f & this.CUSTOMIZED) != 0;} else {o.exclusive = (f === true);}return o;}};js.util.Event.attachEvent = function (dom, eventType, flag, listener, handler) {var fn, args = Array.prototype.slice.call(arguments, 5), check = js.util.Event.FLAG.check(flag), eClass = check.customized ? null : js.awt.Event;args.unshift(listener, eClass);fn = handler.$listen.apply(handler, args);fn.check = check;dom.__handlers__ = dom.__handlers__ || {};dom.__handlers__[eventType] = dom.__handlers__[eventType] || js.util.LinkedList.$decorate([]);dom.__handlers__[eventType].push(fn);if (check.exclusive) {dom["on" + eventType] = fn;} else {if (dom.addEventListener) {dom.addEventListener(eventType, fn, check.captured);} else {dom.attachEvent("on" + eventType, fn);}}return fn;};js.util.Event.detachEvent = function (dom, eventType, flag, listener, handler) {var fn, agents, check;dom.__handlers__ = dom.__handlers__ || {};dom.__handlers__[eventType] = dom.__handlers__[eventType] || js.util.LinkedList.$decorate([]);agents = dom.__handlers__[eventType];for (var i = 0, len = agents.length; i < len; i++) {fn = agents[i];if (fn && ((handler === fn.__host__) || (handler === undefined))) {check = fn.check;if (check.exclusive) {dom["on" + eventType] = null;} else {if (dom.removeEventListener) {dom.removeEventListener(eventType, fn, check.captured);} else {dom.detachEvent("on" + eventType, fn);}}delete fn.__host__;delete fn.check;agents.remove0(i);}}if (agents.length == 0) {delete dom.__handlers__[eventType];}};js.util.Event.W3C_EVT_LOAD = "load";js.util.Event.W3C_EVT_UNLOAD = "unload";js.util.Event.W3C_EVT_RESIZE = "resize";js.util.Event.W3C_EVT_SELECTSTART = "selectstart";js.util.Event.W3C_EVT_MESSAGE = "message";js.util.Event.W3C_EVT_ERROR = "error";js.util.Event.W3C_EVT_MOUSE_DOWN = "mousedown";js.util.Event.W3C_EVT_MOUSE_UP = "mouseup";js.util.Event.W3C_EVT_MOUSE_MOVE = "mousemove";js.util.Event.W3C_EVT_MOUSE_OVER = "mouseover";js.util.Event.W3C_EVT_MOUSE_CLICK = "click";js.util.Event.W3C_EVT_MOUSE_DBCLICK = "dbclick";js.util.Event.SYS_EVT_STATECHANGED = "statechanged";js.util.Event.SYS_EVT_SUCCESS = "success";js.util.Event.SYS_EVT_HTTPERR = "httperr";js.util.Event.SYS_EVT_TIMEOUT = "timeout";js.util.Event.SYS_EVT_MOVING = "moving";js.util.Event.SYS_EVT_MOVED = "moved";js.util.Event.SYS_EVT_RESIZING = "resizing";js.util.Event.SYS_EVT_RESIZED = "resized";js.util.Event.SYS_EVT_ZINDEXCHANGED = "zindexchanged";js.util.Event.SYS_EVT_GEOMCHANGED = "geomchanged";js.util.Event.SYS_MSG_CONSOLEINF = "console_inf";js.util.Event.SYS_MSG_CONSOLEERR = "console_err";js.util.Event.SYS_MSG_CONSOLELOG = "console_log";$package("js.util");js.util.EventListener = function (listener, handler) {var CLASS = js.util.EventListener, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init(listener, handler);return;}CLASS.__defined__ = true;thi$.handleEvent = function () {if (typeof this.handler === "function") {this.handler.apply(this.listener, arguments);}};thi$.equals = function (o) {return o ? (o.listener === this.listener && o.handler === this.handler) : false;};thi$._init = function (l, h) {if (typeof l == "object" && typeof h == "function") {this.listener = l;this.handler = h;if (typeof l.uuid != "function") {var o = this.listener;o.hashCode = function () {if (!this._hash) {this._hash = js.lang.Math.random(new Date().getTime());}return this._hash;};o.uuid = function (id) {if (arguments.length > 0) {this._uuid = id;} else {if (!this._uuid) {this._uuid = js.lang.Math.uuid(this.hashCode());}}return this._uuid;};}this.uuid(l.uuid());}};this._init(listener, handler);}.$extend(js.lang.Object);$package("js.util");$import("js.util.Observable");js.util.EventTarget = function () {var CLASS = js.util.EventTarget, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, A = js.util.LinkedList;var _getListeners = function (eventType) {var hName = "on" + eventType, listeners = this[hName];if (!Class.isArray(listeners)) {listeners = this[hName] = A.$decorate([]);}return listeners;};thi$.addEventListener = function (eventType, fn, captured) {_getListeners.call(this, eventType).push(fn);};thi$.removeEventListener = function (eventType, fn, captured) {_getListeners.call(this, eventType).remove(fn);};var _prepareArgs = function (eventType, flag, listener, handler) {var check = Event.FLAG.check(flag), args = Array.prototype.slice.call(arguments, 0);if (check.customized) {args.unshift(this);} else {if (this.view != undefined) {args.unshift(this.view);} else {args.unshift(this);}}return args;};thi$.attachEvent = function (eventType, flag, listener, handler) {Event.attachEvent.apply(this, _prepareArgs.apply(this, arguments));};thi$.detachEvent = function (eventType, flag, listener, handler) {Event.detachEvent.apply(this, _prepareArgs.apply(this, arguments));};thi$.declareEvent = function (eventType) {this["on" + eventType] = null;};thi$.fireEvent = function (evt) {var eventType = evt instanceof Event ? evt.getType() : evt.toString();var listeners = this["on" + eventType];switch (Class.typeOf(listeners)) {case "function":listeners.call(this, evt);break;case "array":for (var i = 0, len = listeners.length; i < len; i++) {listeners[i](evt);}break;default:break;}};thi$.destroy = function () {var eType, handlers = this.__handlers__;if (handlers) {for (eType in handlers) {this.detachEvent(eType, 4);}delete this.__handlers__;}handlers = this.view ? this.view.__handlers__ : undefined;if (handlers) {for (eType in handlers) {this.detachEvent(eType, 0);this.detachEvent(eType, 1);}this.view.__handlers__ = null;}arguments.callee.__super__.apply(this, arguments);}.$override(this.destroy);this._init.apply(this, arguments);}.$extend(js.util.Observable);$package("js.util");js.util.Messenger = function () {var Q, running = false;this.register = function (msgId, receiver, handler) {var recvs = this.table[msgId];if (recvs === undefined) {recvs = js.util.LinkedList.newInstance([]);this.table[msgId] = recvs;}var recv = new js.util.EventListener(receiver, handler);if (!recvs.contains(recv)) {recvs.push(recv);}};this.cancel = function (msgId, receiver, handler) {var recvs = this.table[msgId];if (recvs === undefined) {return;}var recv = new js.util.EventListener(receiver, handler);var p = recvs.indexOf(recv);if (p != -1) {recvs.remove0(p);if (recvs.length === 0) {delete this.table[msgId];}}};this.remove = function (receiverId) {var indexOf = function (list, id) {for (var i = 0, len = list.length; i < len; i++) {if (list[i].uuid() === id) {return i;}}return -1;};var table = this.table, recvs, idx, p;for (p in table) {recvs = table[p];while ((idx = indexOf(recvs, receiverId)) != -1) {recvs.remove0(idx);}if (recvs.length == 0) {delete this.table[p];}}};this.post = function (msgId, msgData, recvs, device, priority) {var msg = [msgId, msgData, js.lang.Class.typeOf(recvs) === "array" ? recvs : [], device === undefined ? null : device, priority === 0 ? 0 : (priority === 1 ? 1 : 1)];Q[msg[4]].push(msg);if (!running) {_schedule();}};var _schedule = function () {if (Q.isEmpty()) {running = false;} else {running = true;_dispatch.$delay(this, 0);}}.$bind(this);var _dispatch = function () {var msg = Q.get();if (js.lang.Class.typeOf(msg) != "array") {_schedule();return;}var device = msg[3], g, recvs = this.table[msg[0]], recv;if (device != null) {msg[3] = null;if (J$VM.env.j$vm_isworker) {device.postMessage(JSON.stringify(msg));} else {device.postMessage(JSON.stringify(msg), "*");}} else {if (recvs != undefined && recvs.length > 0) {for (var i = 0, len = msg[2].length; i < len; i++) {if (g === undefined) {g = {};}g[msg[2][i]] = true;}for (i = 0, len = recvs.length; i < len; i++) {recv = recvs[i];if (g != undefined) {if (g[recv.uuid()]) {recv.handleEvent.$delay(recv, 0, msg[1]);}} else {recv.handleEvent.$delay(recv, 0, msg[1]);}}}}_schedule();}.$bind(this);this.send = function (msgId, msgData, rcvs, device, priority) {priority = priority === 0 ? 0 : (priority === 1 ? 1 : 1), device = device === undefined ? null : device, rcvs = js.lang.Class.typeOf(rcvs) === "array" ? rcvs : [];var recvs = this.table[msgId], recv, g;if (device != null) {if (J$VM.env.j$vm_isworker) {device.postMessage(JSON.stringify([priority, null, rcvs, msgId, msgData]));} else {device.postMessage(JSON.stringify([priority, null, rcvs, msgId, msgData]), "*");}} else {if (recvs != undefined && recvs.length > 0) {for (var i = 0, len = rcvs.length; i < len; i++) {if (g === undefined) {g = {};}g[rcvs[i]] = true;}for (i = 0, len = recvs.length; i < len; i++) {recv = recvs[i];if (g != undefined) {if (g[recv.uuid()]) {recv.handleEvent(msgData);}} else {recv.handleEvent(msgData);}}}}};var _init = function () {this.table = {};Q = [[], []];Q.isEmpty = function () {return (this[0].length + this[1].length) == 0;};Q.get = function () {var o = this[0].shift();o = (o === undefined) ? this[1].shift() : o;return o;};_schedule();}.call(this);}.$extend(js.lang.Object);$package("js.util");js.util.Document = function () {var CLASS = js.util.Document, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, cache = {}, ATTRIBUTESCT = {acceptcharset:"acceptCharset", accesskey:"accessKey", allowtransparency:"allowTransparency", bgcolor:"bgColor", cellpadding:"cellPadding", cellspacing:"cellSpacing", "class":"className", colspan:"colSpan", checked:"defaultChecked", selected:"defaultSelected", "for":"htmlFor", frameborder:"frameBorder", hspace:"hSpace", longdesc:"longDesc", maxlength:"maxLength", marginwidth:"marginWidth", marginheight:"marginHeight", noresize:"noResize", noshade:"noShade", readonly:"readOnly", rowspan:"rowSpan", tabindex:"tabIndex", valign:"vAlign", vspace:"vSpace"}, BOOLATTRREGEXP = /^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/;thi$.createElement = function (type) {var el = document.createElement(type);if (el.tagName == "IMG") {this.forbidSelect(el);}return el;};var REGX_CAMEL = /[A-Z]/g, REGX_HYPHEN = /-([a-z])/ig, textSps = ["font-family", "font-size", "font-style", "font-weight", "text-decoration", "text-align", "font-weight"], camelMap = {}, hyphenMap = {};thi$.camelName = function (s) {var _s = camelMap[s];if (_s != undefined) {return _s;}_s = s.replace(REGX_HYPHEN, function (a, l) {return l.toUpperCase();});camelMap[s] = _s;if (_s !== s) {hyphenMap[_s] = s;}return _s;};thi$.hyphenName = function (s) {var _s = hyphenMap[s];if (_s !== undefined) {return _s;}_s = s.replace(REGX_CAMEL, function (u) {return "-" + u.toLowerCase();});hyphenMap[s] = _s;if (_s !== s) {camelMap[_s] = s;}return _s;};thi$.currentStyles = function (el, isEle) {var defaultView = document.defaultView, ret;isEle = isEle === undefined ? this.isDOMElement(el) : isEle;if (isEle) {if (defaultView && defaultView.getComputedStyle) {ret = defaultView.getComputedStyle(el, null);} else {ret = el.currentStyle;}} else {ret = {};}return ret;};var _pretreatProp = function (sp) {if (sp == "float") {return J$VM.supports.supportCssFloat ? "cssFloat" : "styleFloat";} else {return this.camelName(sp);}};thi$.getStyle = function (el, sp) {if (el == document) {return null;}var defaultView = document.defaultView;var cs, prop = _pretreatProp.call(this, sp);if (defaultView && defaultView.getComputedStyle) {var out = el.style[prop];if (!out) {cs = defaultView.getComputedStyle(el, "");out = cs ? cs[prop] : null;}if (prop == "marginRight" && out != "0px" && !J$VM.supports.reliableMarginRight) {var display = el.style.display;el.style.display = "inline-block";out = defaultView.getComputedStyle(el, "").marginRight;el.style.display = display;}return out;} else {if (sp == "opacity") {if (el.style.filter.match) {var matches = el.style.filter.match(/alpha\(opacity=(.*)\)/i);if (matches) {var fv = parseFloat(matches[1]);if (!isNaN(fv)) {return fv ? fv / 100 : 0;}}}return 1;}return el.style[prop] || ((cs = el.currentStyle) ? cs[prop] : null);}};thi$.getStyles = function (el, sps) {var styles = {};(function (styles, el, sp) {styles[this.camelName(sp)] = this.getStyle(el, sp);}).$forEach(this, sps || [], styles, el);return styles;};thi$.getAttribute = function (el, attr) {if (!el || el.nodeType !== 1 || !attr) {return "";}var tmp = attr.toLowerCase(), prop = tmp, v;if (J$VM.ie) {prop = ATTRIBUTESCT[attr] || ATTRIBUTESCT[tmp] || attr;} else {prop = tmp;}if (J$VM.ie) {v = el[prop];}if (!v) {v = el.getAttribute(attr);}if (BOOLATTRREGEXP.test(tmp)) {if (el[prop] === true && v === "") {return tmp;}return v ? tmp : "";}return v ? "" + v : "";};thi$.hasAttribute = function (el, attr) {if (el.hasAttribute) {return el.hasAttribute(attr);}return el.getAttribute(attr) == null;};thi$.setAttribute = function (el, attr, value) {if (!el || el.nodeType !== 1 || !attr) {return;}var prop = attr.toLowerCase(), v;if (J$VM.ie) {attr = ATTRIBUTESCT[attr] || ATTRIBUTESCT[prop] || attr;} else {attr = prop;}if (BOOLATTRREGEXP.test(prop)) {if (Class.isString(value)) {v = (value.toLowerCase() === "true");} else {v = (value === true);}if (v) {el.setAttribute(attr, "" + v);} else {el.removeAttribute(attr);}return;}v = Class.isValid(value) ? "" + value : "";if (v.length > 0) {el.setAttribute(attr, v);} else {el.removeAttribute(attr);}};thi$.removeAttribute = function (el, attr) {el.removeAttribute(attr);};thi$.setOpacity = function (el, value) {var style = el.style, currentStyle = el.currentStyle;if (J$VM.ie) {var opacity = isNaN(value) ? "" : "alpha(opacity=" + value * 100 + ")";var filter = currentStyle && currentStyle.filter || style.filter || "";filter = filter.replace(/alpha\(opacity=(.*)\)/i, "").replace(/(^\s*)|(\s*$)/g, "");style.zoom = 1;var filterVal = new js.lang.StringBuffer();filterVal = filterVal.append(filter);filterVal = filter.length > 0 ? filterVal.append(" ") : filterVal;filterVal = filterVal.append(opacity);style.filter = filterVal.toString();} else {style.opacity = value;}};thi$.clearOpacity = function (el) {var style = el.style;if (J$VM.ie) {var filter = style.filter;style.filter = filter ? filter.replace(/alpha\(opacity=(.*)\)/i, "").replace(/(^\s*)|(\s*$)/g, "") : "";} else {style.opacity = style["-moz-opacity"] = style["-khtml-opacity"] = "";}};thi$.applyStyles = function (el, styles) {(function (el, value, sp) {if (sp.toLowerCase() == "opacity") {this.setOpacity(el, value);} else {sp = _pretreatProp.call(this, sp);el.style[sp] = value;}}).$map(this, styles || {}, el);};thi$.parseNumber = function (value) {var i = Class.isValid(value) ? parseInt(value) : 0;if (Class.isNumber(i)) {return i;}switch (value.toLowerCase()) {case "thin":return 1;case "medium":return 3;case "thick":return 5;default:return 0;}};thi$.getBorderWidth = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.borderTopWidth) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);var bs = currentStyles["borderTopStyle"].toLowerCase();MBP.borderTopWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderTopWidth"]));bs = currentStyles["borderRightStyle"].toLowerCase();MBP.borderRightWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderRightWidth"]));bs = currentStyles["borderBottomStyle"].toLowerCase();MBP.borderBottomWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderBottomWidth"]));bs = currentStyles["borderLeftStyle"].toLowerCase();MBP.borderLeftWidth = ((!bs || bs === "none") ? 0 : this.parseNumber(currentStyles["borderLeftWidth"]));}return bounds.MBP;};thi$.getPadding = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.paddingTop) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);MBP.paddingTop = this.parseNumber(currentStyles["paddingTop"]);MBP.paddingRight = this.parseNumber(currentStyles["paddingRight"]);MBP.paddingBottom = this.parseNumber(currentStyles["paddingBottom"]);MBP.paddingLeft = this.parseNumber(currentStyles["paddingLeft"]);}return bounds.MBP;};thi$.getMargin = function (el, currentStyles, isEle) {var bounds = el.bounds;if (!bounds) {bounds = el.bounds = {};}if (!bounds.MBP || !bounds.MBP.marginTop) {var MBP = bounds.MBP = bounds.MBP || {};isEle = isEle === undefined ? this.isDOMElement(el) : isEle;currentStyles = currentStyles || this.currentStyles(el, isEle);MBP.marginTop = this.parseNumber(currentStyles["marginTop"]);MBP.marginRight = this.parseNumber(currentStyles["marginRight"]);MBP.marginBottom = this.parseNumber(currentStyles["marginBottom"]);MBP.marginLeft = this.parseNumber(currentStyles["marginLeft"]);}return bounds.MBP;};thi$.getBoundRect = function (el, isEle) {isEle = isEle === undefined ? this.isDOMElement(el) : isEle;return isEle ? el.getBoundingClientRect() : {left:0, top:0, bottom:0, right:0};};thi$.outerSize = function (el, isEle) {if (el.tagName !== "BODY") {var r = this.getBoundRect(el, isEle);return {left:r.left, top:r.top, width:r.right - r.left, height:r.bottom - r.top};} else {var backCompat = document.compatMode === "BackCompat";return {left:0, top:0, width:backCompat ? document.body.clientWidth : document.documentElement.clientWidth, height:backCompat ? document.body.clientHeight : document.documentElement.clientHeight};}};thi$.outerWidth = function (el, isEle) {return this.outerSize(el, isEle).width;};thi$.outerHeight = function (el, isEle) {return this.outerSize(el, isEle).height;};thi$.innerSize = function (el, currentStyles, isEle) {var o = this.outerSize(el, isEle), b = this.getBorderWidth(el, currentStyles, isEle), p = this.getPadding(el, currentStyles, isEle);return {width:o.width - b.borderLeftWidth - b.borderRightWidth - p.paddingLeft - p.paddingRight, height:o.height - b.borderTopWidth - b.borderBottomWidth - p.paddingTop - p.paddingBottom};};thi$.innerWidth = function (el, currentStyles, isEle) {return this.innerSize(el, currentStyles, isEle).width;};thi$.innerHeight = function (el, currentStyles, isEle) {return this.innerSize(el, currentStyles, isEle).height;};thi$.setSize = function (el, w, h, bounds) {bounds = bounds || this.getBounds(el);var BBM = bounds.BBM, styleW, styleH;if (BBM) {styleW = w;styleH = h;} else {styleW = w - bounds.MBP.BPW;styleH = h - bounds.MBP.BPH;}if (Class.isNumber(styleW) && styleW >= 0) {bounds.width = w;el.style.width = styleW + "px";}if (Class.isNumber(styleH) && styleH >= 0) {bounds.height = h;el.style.height = styleH + "px";}};thi$.absXY = function (el, isEle) {var r = this.getBoundRect(el, isEle);return {x:r.left, y:r.top};};thi$.absX = function (el, isEle) {return this.absXY(el, isEle).x;};thi$.absY = function (el, isEle) {return this.absXY(el, isEle).y;};thi$.offsetXY = function (el) {return {x:el.offsetLeft, y:el.offsetTop};};thi$.offsetX = function (el) {return this.offsetXY(el).x;};thi$.offsetY = function (el) {return this.offsetXY(el).y;};thi$.setPosition = function (el, x, y, bounds) {bounds = bounds || this.getBounds(el);if (Class.isNumber(x)) {bounds.x = x;el.style.left = x + "px";}if (Class.isNumber(y)) {bounds.y = y;el.style.top = y + "px";}};thi$.getBounds = function (el) {var isEle = _checkElement.call(this, el), outer = this.outerSize(el, isEle), bounds = el.bounds = el.bounds || {};if (bounds.BBM === undefined) {bounds.BBM = (J$VM.supports.borderBox || Class.typeOf(el) === "htmlinputelement" || Class.typeOf(el) === "htmltextareaelement");var currentStyles = this.currentStyles(el, isEle);this.getMargin(el, currentStyles, isEle);this.getPadding(el, currentStyles, isEle);this.getBorderWidth(el, currentStyles, isEle);var MBP = bounds.MBP;MBP.BW = MBP.borderLeftWidth + MBP.borderRightWidth;MBP.BH = MBP.borderTopWidth + MBP.borderBottomWidth;MBP.PW = MBP.paddingLeft + MBP.paddingRight;MBP.PH = MBP.paddingTop + MBP.paddingBottom;MBP.BPW = MBP.BW + MBP.PW;MBP.BPH = MBP.BH + MBP.PH;}bounds.width = outer.width;bounds.height = outer.height;bounds.absX = outer.left;bounds.absY = outer.top;return bounds;};thi$.setBounds = function (el, x, y, w, h, bounds) {this.setPosition(el, x, y, bounds);this.setSize(el, w, h, bounds);};thi$.hasScrollbar = function (el) {var MBP = this.getBounds(el).MBP, vbw = el.offsetWidth - el.clientWidth - MBP.BW, hbw = el.offsetHeight - el.clientHeight - MBP.BH;return {vbw:vbw, hbw:hbw, vscroll:vbw > 1, hscroll:hbw > 1};};thi$.removeFun = function (el) {if (!el) {return;}if (el.nodeType == 1) {var handlers = el.__handlers__, eventType;if (handlers) {for (eventType in handlers) {Event.detachEvent(el, eventType);}}el.__handlers__ = undefined;el.bounds = undefined;}var a = el.attributes, i, l, n;if (a) {for (i = a.length - 1; i >= 0; i--) {n = a[i].name;if (typeof el[n] === "function") {el[n] = null;}}}a = el.childNodes;if (a) {for (i = 0, l = a.length; i < l; i++) {arguments.callee(a.item(i));}}};thi$.remove = function () {var p;return function (el, gc) {if (!el) {return;}if (gc) {this.removeFun(el);if (Class.typeOf(el) != "htmlbodyelement") {p = p || document.createElement("DIV");p.appendChild(el);p.innerHTML = "";}}if (el.parentNode) {el.parentNode.removeChild(el);}};}();thi$.removeFrom = function (el, parentNode) {if (!el) {return;}parentNode = parentNode || el.parentNode;parentNode.removeChild(el);};thi$.appendTo = function (el, parentNode) {parentNode.appendChild(el);};thi$.insertBefore = function (el, refNode, parentNode) {parentNode = parentNode || refNode.parentNode;if (refNode) {parentNode.insertBefore(el, refNode);} else {parentNode.appendChild(el);}};thi$.insertAfter = function (el, refNode) {this.insertBefore(el, refNode.nextSibling, refNode.parentNode);};thi$.contains = function (el, child, containSelf) {if (el.compareDocumentPosition) {var res = el.compareDocumentPosition(child);if (containSelf && res === 0) {return true;} else {return res === 20;}} else {if (containSelf && el === child) {return true;} else {return el.contains(child);}}};thi$.isDOMElement = function (el) {return this.contains(document.body, el, true);};var _checkElement = function (el) {if (!this.isDOMElement(el)) {var err = "The element " + (el.id || el.name) + " is not a DOM element.";J$VM.System.err.println(err);return false;}return true;};var _breakEventChian = function (e) {if (e.getType() == "selectstart") {var el = e.srcElement, elType = Class.typeOf(el);if (elType == "htmlinputelement" || elType == "htmltextareaelement") {return true;}}e.cancelBubble();return e.cancelDefault();};thi$.forbidSelect = function (el) {if (typeof document.onselectstart != "function") {Event.attachEvent(document, "selectstart", 1, this, _breakEventChian);}if (typeof el.ondragstart != "function") {Event.attachEvent(el, "dragstart", 1, this, _breakEventChian);}};thi$.toCssText = function (styles) {if (typeof styles !== "object") {return "";}if (typeof styles !== "object") {return "";}var buf = new js.lang.StringBuffer(), p, v;for (p in styles) {v = styles[p];p = this.hyphenName(p);buf.append(p).append(":").append(v).append(";");}return buf.toString();};thi$.getTextSize = function (span) {if (!span || span.tagName !== "SPAN") {return {width:0, height:0};}var styles = {display:"inline", "white-space":"nowrap", position:"absolute", left:"-10000px", top:"-10000px"};styles = J$VM.System.objectCopy(styles, this.getStyles(span, textSps) || {});var textNode = this.createElement("SPAN");textNode.innerHTML = span.innerHTML;textNode.style.cssText = this.toCssText(styles);this.appendTo(textNode, document.body);var s = this.outerSize(textNode);this.remove(textNode, true);textNode = null;return s;};thi$.setHTML = function (el, html) {if (J$VM.ie) {while (el.firstChild) {el.removeChild(el.firstChild);}try {el.innerHTML = "<br />" + html;el.removeChild(el.firstChild);}catch (e) {var tempDiv = this.create("div");tempDiv.innerHTML = "<br />" + html;var children = tempDiv.childNodes, len = children ? children.length : 0;for (var i = 1; i < len; i++) {el.appendChild(children[i]);}}} else {el.innerHTML = html;}return el;};thi$.addStyle = function (css, doc) {doc = doc || document;if (!css || !doc) {return;}var head = doc.getElementsByTagName("head")[0], styleElements = head.getElementsByTagName("style"), styleElement, media, tmpEl;if (styleElements.length == 0) {if (J$VM.ie) {doc.createStyleSheet();} else {tmpEl = doc.createElement("style");tmpEl.setAttribute("type", "text/css");head.appendChild(tmpEl);}}styleElement = styleElements[0];media = styleElement.getAttribute("media");if (media != null && !/screen/.test(media.toLowerCase())) {styleElement.setAttribute("media", "screen");}if (J$VM.ie) {styleElement.styleSheet.cssText += css;} else {if (J$VM.firefox) {styleElement.innerHTML += css;} else {styleElement.appendChild(doc.createTextNode(css));}}};}.$extend(js.lang.Object);$package("js.util");$import("js.util.HashMap");js.util.MemoryStorage = function () {var CLASS = js.util.MemoryStorage, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class;var _check = function () {var hasStorage = (this._storage != null && this._storage != undefined);if (arguments.length > 0) {var key = arguments[0];if (typeof key === "string" && key.length > 0) {return hasStorage;} else {return false;}}return hasStorage;};thi$.keys = function () {return this._storage.keys();};thi$.length = function () {return this._storage.size();};thi$.key = function (index) {return this._storage.keys().get(index);};thi$.setItem = function (key, value) {if (!_check.call(this, key)) {return;}switch (Class.typeOf(value)) {case "string":this._storage.put(key, value);break;case "object":case "array":this._storage.put(key, JSON.stringify(value));break;default:break;}};thi$.getItem = function (key) {if (!_check.call(this, key)) {return null;}var value = this._storage.getItem(key);if (value) {if (Class.typeOf(value) == "string" && (value.indexOf("{") == 0 || value.indexOf("[") == 0)) {value = JSON.parse(value);}}return value;};thi$.removeItem = function (key) {if (!_check.call(this, key)) {return;}this._storage.remove(key);};thi$.clear = function () {this._storage.clear();};thi$._init = function () {this._storage = new js.util.HashMap();};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.util");js.util.Storage = function (storage) {var CLASS = js.util.Storage, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class;var _check = function () {var hasStorage = (this._storage != null && this._storage != undefined);if (arguments.length > 0) {var key = arguments[0];if (typeof key === "string" && key.length > 0) {return hasStorage;} else {return false;}}return hasStorage;};thi$.keys = function () {var keys = [];for (var i = 0, len = this.length(); i < len; i++) {keys[i] = this._storage.key(i);}return keys;};thi$.length = function () {return _check() ? this._storage.length : 0;};thi$.key = function (index) {return _check() ? this._storage.key(index) : undefined;};thi$.setItem = function (key, value) {if (!_check.call(this, key)) {return;}switch (Class.typeOf(value)) {case "string":this._storage.setItem(key, value);break;case "object":case "array":this._storage.setItem(key, JSON.stringify(value));break;default:break;}};thi$.getItem = function (key) {if (!_check.call(this, key)) {return null;}var value = this._storage.getItem(key);if (value) {if (Class.typeOf(value) == "string" && (value.indexOf("{") == 0 || value.indexOf("[") == 0)) {value = JSON.parse(value);}}return value;};thi$.removeItem = function (key) {if (!_check.call(this, key)) {return;}this._storage.removeItem(key);};thi$.clear = function () {if (!_check.call(this)) {return;}this._storage.clear();};thi$._init = function (storage) {this._storage = storage;};this._init.apply(this, arguments);}.$extend(js.lang.Object);js.util.Storage.getStorage = function (type) {var _storage, _storageObj;switch (type) {case "local":try {_storage = window.localStorage;}catch (x) {}break;case "session":try {_storage = window.sessionStorage;}catch (e) {}break;default:break;}if (_storage) {_storageObj = new js.util.Storage(_storage);} else {_storageObj = new js.util.MemoryStorage();}return _storageObj;};$package("js.util");js.util.Cookie = function (k, v, e, p, d, s) {var CLASS = js.util.Cookie, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;thi$.getName = function () {return this._name;};thi$.getValue = function () {return this._value;};thi$.setValue = function (v) {this._value = v;};thi$.getMaxAge = function () {return this._maxAge;};thi$.setMaxAge = function (expiry) {this._maxAge = (typeof expiry === "number" && !isNaN(expiry)) ? expiry * 1000 : undefined;};thi$.getPath = function () {return this._path;};thi$.setPath = function (uri) {this._path = (typeof uri === "string") ? uri : "/";};thi$.getDomain = function () {return this._domain;};thi$.setDomain = function (pattern) {this._domain = (typeof pattern === "string") ? pattern.toLowerCase() : undefined;};thi$.setSecure = function (s) {this._secure = (s === true) ? true : undefined;};thi$.toString = function () {var buf = new js.lang.StringBuffer();buf.append(this._name).append("=").append(this._value ? escape(this._value) : "");if (typeof this._maxAge === "number") {var exp = new Date();exp.setTime(exp.getTime() + this._maxAge);buf.append(";expire=").append(exp.toGMTString());}if (this._path) {buf.append(";path=").append(this._path);}if (this._domain) {buf.append(";domain=").append(this._domain);}if (this._secure === true) {buf.append(";secure").append(this._secure);}return buf.toString();};thi$._init = function (k, v, e) {this._name = k;this.setValue(v);this.setMaxAge(e);this.setPath(p);this.setDomain(d);};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.util");$import("js.util.Cookie");js.util.CookieStorage = function () {var CLASS = js.util.CookieStorage, thi$ = CLASS.prototype;if (CLASS.__defined__) {this.parseCookies();return;}CLASS.__defined__ = true;var cookies;thi$.setCookie = function (name, value, expire, path, domain, secure) {this.add(new js.util.Cookie(name, value, expire, path, domain, secure));};thi$.getCookie = function (name) {var cookie = this.get(name);return cookie ? cookie.getValue() : undefined;};thi$.delCookie = function (name) {var cookie = this.get(name);if (cookie) {this.remove(cookie);}};thi$.add = function (cookie, uri) {document.cookie = cookie.toString();this.parseCookies();};thi$.get = function (name) {return cookies[name];};thi$.remove = function (cookie, uri) {cookie.setMaxAge(-1);this.add(cookie, uri);};thi$.parseCookies = function () {cookies = cookies || {};for (var p in cookies) {delete cookies[p];}var vs = document.cookie.split(";"), item, n, v;for (var i = 0, len = vs.length; i < len; i++) {item = vs[i].split("=");n = item[0];v = unescape(item[1]);cookies[n] = new js.util.Cookie(n, v);}};this.parseCookies();}.$extend(js.lang.Object);$package("js.net");js.net.URI = function (url) {var CLASS = js.net.URI, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Keys = ["source", "scheme", "userInfo", "user", "password", "host", "port", "path", "query", "fragment"];var UrlRegExp = new RegExp("([-+a-zA-Z0-9]+)://" + "((.[^:]*):?(.*)?@)?" + "(.[^:/]*)" + ":?([0-9]{1,6})?" + "(/.[^?#]*)" + "[?]?(.[^#]*)?" + "#?(.*)?");var QueryRegExp = new RegExp("(?:^|&)([^&=]*)=?([^&]*)", "g");thi$._parse = function (query) {var params = {};if (query) {query.replace(QueryRegExp, function ($0, $1, $2) {if ($1) {params[$1] = $2;}});}return params;};thi$._init = function () {if (arguments.length === 1) {var res = UrlRegExp.exec(decodeURI(arguments[0]));for (var i = 0, len = res.length; i < len; i++) {this[Keys[i]] = res[i];}} else {this.scheme = arguments[0];this.userInfo = arguments[1];this.host = arguments[2];this.port = arguments[3];this.path = arguments[4];this.query = arguments[5];this.fragment = arguments[6];}this.params = this._parse(this.query);};this._init.apply(this, arguments);}.$extend(js.lang.Object);$package("js.net");js.net.XHRPROVIDER = {progid:undefined, progids:["MSXML2.XMLHTTP.6.0", "MSXML2.XMLHTTP", "Microsoft.XMLHTTP"]};js.net.HttpURLConnection = function (isAsync) {var Class = js.lang.Class, Event = js.util.Event;var CLASS = js.net.HttpURLConnection, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init(isAsync != undefined ? isAsync : true);return;}CLASS.__defined__ = true;thi$.isAsync = function () {return this._async || false;};thi$.setAsync = function (isAsync) {this._async = isAsync || false;if (this._async) {this.declareEvent(Event.SYS_EVT_SUCCESS);this.declareEvent(Event.SYS_EVT_HTTPERR);}};thi$.isNoCache = function () {return this._nocache || false;};thi$.setNoCache = function (isNoCache) {this._nocache = isNoCache || false;};thi$.setRequestHeader = function (key, value) {this._headers = this._headers || {};this._headers[key] = value;};thi$.getTimeout = function () {return this._timeout;};thi$.setTimeout = function (v) {this._timeout = v;};thi$.getResponseHeader = function (key) {return this._xhr.getResponseHeader(key);};thi$.getAllResponseHeaders = function () {return this._xhr.getAllResponseHeaders();};thi$.responseText = function () {return this._xhr.responseText;};thi$.responseXML = function () {return this._xhr.responseXML;};thi$.responseJSON = function () {return JSON.parse(this._xhr.responseText);};thi$.status = function () {return this._xhr.status;};thi$.statusText = function () {return this._xhr.statusText;};thi$.readyState = function () {return this._xhr.readyState;};thi$.open = function (method, url, params) {var _url, query = _makeQueryString.$bind(this)(params), xhr = this._xhr, async = this.isAsync();switch (method.toUpperCase()) {case "GET":_url = (query != null) ? [url, "?", query].join("") : url;query = null;break;case "POST":_url = url;this.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");break;default:break;}if (async) {xhr.onreadystatechange = function () {switch (xhr.readyState) {case 2:case 3:var status = 200;try {status = xhr.status;}catch (x) {}if (status != 200 && status != 304) {_stopTimeout.call(this);this.fireEvent(new Event(Event.SYS_EVT_HTTPERR, this, this));}break;case 4:_stopTimeout.call(this);switch (xhr.status) {case 200:case 304:this.fireEvent(new Event(Event.SYS_EVT_SUCCESS, this, this));break;default:this.fireEvent(new Event(Event.SYS_EVT_HTTPERR, this, this));break;}break;default:_stopTimeout.call(this);break;}}.$bind(this);}this.timer = _checkTimeout.$delay(this, this.getTimeout());xhr.open(method, _url, async);_setRequestHeader.$bind(this)(xhr, this._headers);xhr.send(query);};thi$.close = function () {_stopTimeout.call(this);this._xhr.onreadystatechange = null;this._xhr = null;this._headers = null;};var _checkTimeout = function () {if (this._xhr) {this._xhr.abort();this.fireEvent(new Event(Event.SYS_EVT_TIMEOUT, this, this));}};var _stopTimeout = function () {_checkTimeout.$clearTimer(this.timer);delete this.timer;};var _makeQueryString = function (params) {if (typeof params != "object") {return null;}var buf = new js.lang.StringBuffer();for (var p in params) {buf.append(p).append("=").append(params[p]).append("&");}if (this.isNoCache()) {buf.append("_=").append(js.lang.Math.random());}return buf.toString();};var _setRequestHeader = function (_xhr, map) {if (map) {for (var p in map) {_xhr.setRequestHeader(p, map[p]);}}};thi$._init = function (isAsync) {if (XMLHttpRequest != undefined) {this._xhr = new XMLHttpRequest();} else {var $ = js.net.XHRPROVIDER;if ($.progid != undefined) {this._xhr = new ActiveXObject($.progid);} else {for (var i = 0; i < $.progids.length; i++) {$.progid = $.progids[i];try {this._xhr = new ActiveXObject($.progid);break;}catch (x) {}}}}this.setAsync(isAsync);this.setNoCache(J$VM.System.getProperty("j$vm_ajax_nocache", true));this.setTimeout(J$VM.System.getProperty("j$vm_ajax_timeout", 600000));this.declareEvent(Event.SYS_EVT_TIMEOUT);};this._init(isAsync != undefined ? isAsync : true);}.$extend(js.util.EventTarget);$package("js.awt");$import("js.util.Event");js.awt.Event = function (e) {var CLASS = js.awt.Event, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;thi$.eventXY = function () {return {x:this.clientX, y:this.clientY};};thi$.offsetXY = function () {return {x:this.offsetX, y:this.offsetY};};thi$.cancelBubble = function () {var _e = this._event;if (_e.stopPropagation) {_e.stopPropagation();} else {try {_e.cancelBubble = true;}catch (x) {}}};thi$.cancelDefault = function () {var _e = this._event;if (_e.preventDefault) {_e.preventDefault();} else {try {_e.returnValue = false;}catch (x) {}}return false;};thi$._init = function (e) {var _e = this._event = e || window.event;arguments.callee.__super__.call(this, _e.type, _e);var ie = (_e.stopPropagation == undefined), ff = (J$VM.firefox != undefined);this.altKey = _e.altKey || false;this.ctrlKey = _e.ctrlKey || false;this.shiftKey = _e.shiftKey || false;this.metaKey = _e.metaKey || false;this.keyCode = ie ? _e.keyCode : _e.which;switch (_e.button) {case 0:this.button = 1;break;case 1:this.button = ie ? 1 : 4;break;default:this.button = _e.button;break;}this.clientX = ie ? (_e.clientX + document.documentElement.scrollLeft - document.body.clientLeft) : _e.pageX;this.clientY = ie ? (_e.clientY + document.documentElement.scrollTop - document.body.clientTop) : _e.pageY;this.offsetX = ff ? _e.layerX : _e.offsetX;this.offsetY = ff ? _e.layerY : _e.offsetY;this.srcElement = ie ? _e.srcElement : _e.target;var type = this.getType();this.fromElement = ie ? _e.fromElement : ((type == "mouseover") ? _e.relatedTarget : (type == "mouseout" ? _e.target : undefined));this.toElement = ie ? _e.toElement : ((type == "mouseout") ? _e.relatedTarget : (type == "mouseover" ? _e.target : undefined));}.$override(this._init);this._init.apply(this, arguments);}.$extend(js.util.Event);js.lang.Runtime = function () {var CLASS = js.lang.Runtime, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event;thi$.PID = function (pid) {if (pid != undefined) {this._local.pid = pid;}return this._local.pid;};thi$.userInfo = function (userinfo) {if (Class.is(userinfo, "object")) {this._local.userinfo = userinfo;}return this._local.userinfo;};thi$.dateSymbols = function (symbols) {if (Class.is(symbols, "object")) {this._local.symbols = symbols;}return this._local.symbols || Class.forName("js.text.DateFormatSymbols").Default;};thi$.setDict = function (dict) {this._local.dict = dict || {};};thi$.getDict = function () {if (!this._local.dict) {this._local.dict = {};}return this._local.dict;};thi$.nlsText = function (key, defaultText) {var dict = this._local.dict;return dict ? (dict[key] || (defaultText || key)) : (defaultText || key);};thi$.prefer = function (prefer) {if (Class.isObject(prefer)) {this._local.prefer = prefer;}return this._local.prefer;};thi$.themes = function (themes) {if (Class.isArray(themes)) {this._local.themes = themes;}return this._local.themes;};thi$.theme = function (theme) {if (Class.isString(theme)) {this._local.theme = theme;}return this._local.theme || "default";};thi$.imagePath = function (imagePath) {if (Class.isString(imagePath)) {this._local.imagePath = imagePath;}return this._local.imagePath || "../../style/" + this.theme() + "/images/";};thi$.postEntry = function (entry) {if (Class.isString(entry)) {this.servlet = this._local.postEntry = entry;}return this._local.postEntry;};thi$.getsEntry = function (entry) {if (Class.isString(entry)) {this.getpath = this._local.getsEntry = entry;}return this._local.getsEntry;};thi$.getProperty = function (key, defValue) {return this._local[key] || defValue;};thi$.setProperty = function (key, value) {this._local[key] = value;};thi$.mode = function (mode) {if (Class.isNumber(mode)) {this._local.mode = mode;}return this._local.mode || 0;};thi$.isEditMode = function () {return (this.mode() & 1) != 0;};thi$.message = function (type, subject, content) {switch (type) {case "info":J$VM.System.out.println(subject + ": " + content);break;case "warn":J$VM.System.err.println(subject + ": " + content);break;case "error":J$VM.System.err.println(subject + ": " + content);break;default:throw "Unsupport message type " + type;break;}};};js.lang.NoUIRuntime = function () {var CLASS = js.lang.NoUIRuntime, thi$ = CLASS.prototype;if (CLASS.__defined__) {return;}CLASS.__defined__ = true;}.$extend(js.util.EventTarget).$implements(js.lang.Runtime);js.lang.System = function (env, vm) {var props, os;this.currentTimeMillis = function () {return (new Date()).getTime();};this.getProperties = function () {return props;};this.getProperty = function (key, defaultValue) {return props.getProperty(key, defaultValue);};this.setProperty = function (key, value) {props.setProperty(key, value);};this.setOut = function (print) {os = print;};this.out = function () {return {println:function (s) {if (os) {os.info(s);}}};}();this.err = function () {return {println:function (s) {if (os) {os.error(s);}}};}();this.log = function () {return {println:function (s) {var $ = props.getProperty("j$vm_log", false);if (os && $ === true) {os.log(s);}}};}();this.exit = function () {this.gc();if (self.opener) {window.close();} else {self.opener = self;window.close();}};this.objectCopy = function (src, des, deep, merge) {var typeOf = js.lang.Class.typeOf, t = typeOf(src), item;switch (t) {case "object":des = (des === null || des === undefined) ? {} : des;for (var p in src) {item = src[p];if (deep === true) {switch (typeOf(item)) {case "object":if (merge === true) {des[p] = this.objectCopy(item, des[p], deep, merge);} else {des[p] = this.objectCopy(item, null, deep);}break;case "array":des[p] = this.arrayCopy(item, 0, [], 0, item.length, deep);break;default:des[p] = item;}} else {des[p] = item;}}break;case "array":des = this.arrayCopy(src, 0, des, 0, src.length, deep);break;default:des = src;break;}return des;}.$bind(this);this.arrayCopy = function (src, srcPos, des, desPos, length, deep) {var typeOf = js.lang.Class.typeOf, srcIdx = srcPos, desIdx = desPos, item;des = (des === null || des === undefined) ? [] : des;for (var i = 0; i < length; i++) {if (srcIdx > src.length - 1) {break;}item = src[srcIdx];if (deep === true) {switch (typeOf(item)) {case "object":des[desIdx++] = this.objectCopy(item, null, deep);break;case "array":des[desIdx++] = this.arrayCopy(item, 0, [], 0, item.length, deep);break;default:des[desIdx++] = item;break;}} else {des[desIdx++] = item;}srcIdx++;}return des;}.$bind(this);this.gc = function () {if (J$VM.ie) {CollectGarbage();}};var last = 0;this.checkThreshold = function (now, newThreshold) {if ((now - last) > (newThreshold ? newThreshold : this.getProperty("j$vm_threshold", 45))) {last = now;return true;}return false;};var _buildEnv = function () {var script = document.getElementById("j$vm");if (script) {var attrs = script.attributes, name, value;for (var i = 0, len = attrs.length; i < len; i++) {name = attrs[i].nodeName;value = attrs[i].nodeValue;switch (name) {case "src":case "crs":var p = value.lastIndexOf("/");this.setProperty("j$vm_home", value.substring(0, p));break;case "classpath":value = value.replace(/(\s*)/g, "");this.setProperty("j$vm_classpath", value);break;default:if (name.indexOf("-d") == 0 || name.indexOf("-D") == 0) {var tmp = parseInt(value);value = isNaN(tmp) ? (value === "true" ? true : (value === "false" ? false : value)) : tmp;this.setProperty(name.substring(2), value);}break;}}vm.uuid(js.lang.Math.uuid());vm.id = vm.uuid();} else {throw new Error("Can't not found J$VM home");}};var _buildWorkerEnv = function () {var path = vm.env.uri.path;var p = path.indexOf("/classes/js/util/Worker.jz");p = p == -1 ? path.indexOf("/src/js/util/Worker.js") : p;vm.env.j$vm_home = path.substring(0, p);vm.uuid(js.lang.Math.uuid());};var _checkBrowser = function () {vm.supports = {reliableMarginRight:true, supportCssFloat:true};var buf = [], doc = document, div = doc.createElement("div");buf.push("<div style=\"height:30px;width:50px;left:0px;\">");buf.push("<div style=\"height:20px;width:20px;\"></div></div>");buf.push("<div style=\"float:left;\"></div>");div.innerHTML = buf.join("");div.style.cssText = "position:absolute;width:100px;height:100px;" + "border:5px solid black;padding:5px;" + "visibility:hidden;";doc.body.appendChild(div);var view = doc.defaultView, ccdiv = div.firstChild.firstChild;if (view && view.getComputedStyle && (view.getComputedStyle(ccdiv, null).marginRight != "0px")) {vm.supports.reliableMarginRight = false;}vm.supports.supportCssFloat = !!div.lastChild.style.cssFloat;vm.supports.borderBox = !(div.offsetWidth > 100);doc.body.removeChild(div);div = view = undefined;};var _onload = function (e) {J$VM.System.out.println("J$VM load...");_checkBrowser.call(this);var Event = js.util.Event, dom = vm.hwnd.document;Event.attachEvent(dom, "keydown", 0, this, _onkeyevent);Event.attachEvent(dom, "keyup", 0, this, _onkeyevent);var proc, scope, i, len, body;for (i = 0, len = scopes.length; i < len; i++) {proc = scopes[i];scope = vm.runtime[proc.id];if (scope === undefined) {scope = vm.runtime[proc.id] = function () {var clazz = js.lang.Class.forName("js.awt.Desktop");return clazz ? new (clazz)(proc.container) : new js.lang.NoUIRuntime();}();scope.id = proc.id;}proc.fn.call(scope, this);}};this.forceInit = function () {_onload.call(this);};var _onbeforeunload = function () {};var _onunload = function (e) {J$VM.System.out.println("J$VM unload...");var Event = js.util.Event, dom = vm.hwnd.document;var scopes = vm.runtime, scopeName, scope;for (scopeName in scopes) {scope = scopes[scopeName];if (js.lang.Class.isFunction(scope.beforeUnload)) {scope.beforeUnload.call(scope);}scope.destroy();}delete vm.runtime;this.gc();J$VM = undefined;js = undefined;com = undefined;dom.body.innerHTML = "";};var _onresize = function (e) {if (this.checkThreshold(e.getTimeStamp().getTime())) {var scopes = vm.runtime, scopeName, scope;for (scopeName in scopes) {scope = scopes[scopeName];scope.fireEvent.call(scope, e);}}};var _onmessage = function (e) {var _e = e.getData();if (_e.source == self) {return;}var msg;try {msg = JSON.parse(_e.data);}catch (x) {}if (js.lang.Class.isArray(msg)) {e.message = msg[1];J$VM.MQ.post(msg[0], e, msg[2], null, msg[4]);}};var _onkeyevent = function (e) {J$VM.MQ.post("js.awt.event.KeyEvent", e);};var scopes = [];var _exec = function (instName, fn, containerElement) {if (vm.runtime === undefined) {vm.runtime = {};}scopes.push({id:instName, fn:fn, container:containerElement});};var _init = function (env, vm) {var E = js.util.Event;props = new js.util.Properties(env);vm.Class = js.lang.Class;vm.MQ = new js.util.Messenger();if (!vm.env.j$vm_isworker) {_buildEnv.call(this);os = self.console ? self.console : null;vm.hwnd = self;vm.DOM = new js.util.Document();vm.storage = {local:js.util.Storage.getStorage("local"), session:js.util.Storage.getStorage("session"), cookie:new js.util.CookieStorage()};vm.exec = function (instName, fn, containerElement) {if (typeof fn != "function") {throw "The second parameter must be a function";}return _exec.call(this, instName, fn, containerElement);}.$bind(this);E.attachEvent(vm.hwnd, E.W3C_EVT_LOAD, 0, this, _onload);E.attachEvent(vm.hwnd, E.W3C_EVT_UNLOAD, 0, this, _onunload);E.attachEvent(vm.hwnd, E.W3C_EVT_RESIZE, 0, this, _onresize);E.attachEvent(vm.hwnd, E.W3C_EVT_MESSAGE, 0, this, _onmessage);} else {os = new function () {var post = vm.MQ.post;this.info = function (s) {post(E.SYS_MSG_CONSOLEINF, s, [], self, 1);};this.error = function (s) {post(E.SYS_MSG_CONSOLEERR, s, [], self, 1);};this.log = function (s) {post(E.SYS_MSG_CONSOLELOG, s, [], self, 1);};}();_buildWorkerEnv.call(this);}};if (env != undefined && vm != undefined) {_init.apply(this, arguments);}}.$extend(js.lang.Object);js.lang.Thread = function (Runnable) {var CLASS = js.lang.Thread, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class, Event = js.util.Event, System = J$VM.System, MQ = J$VM.MQ;var _onmessage = function (e) {var evt = e.getData(), data;if (evt.source == self) {return;}try {data = JSON.parse(evt.data);}catch (x) {data = evt.data;}if (Class.isArray(data)) {switch (data[0]) {case Event.SYS_MSG_CONSOLEINF:System.out.println(data[1]);break;case Event.SYS_MSG_CONSOLEERR:System.err.println(data[1]);break;case Event.SYS_MSG_CONSOLELOG:System.log.println(data[1]);break;default:var fun = "on" + data[0];if (typeof this[fun] == "function") {this[fun](data[1]);}}} else {if (typeof this.onmessage == "function") {this.onmessage(data);}}};var _onerror = function (e) {var evt = e.getData(), data;if (evt.source == self) {return;}System.err.println(evt.data);};thi$.submitTask = function (task, isRunnable) {if (task == undefined || task == null) {return;}isRunnable = isRunnable || false;var context, run, worker = this._worker;if (isRunnable) {context = task.context;run = task.run;} else {context = task;run = this._runnable.run;}var buf = new js.lang.StringBuffer();buf.append("var thi$ = {");buf.append("context:").append(JSON.stringify(context));buf.append(",run:").append(run);buf.append("}");var msg = buf.toString();if (self.Worker) {worker.postMessage(msg);} else {worker.postMessage(msg, "*");}};thi$.start = function () {this.submitTask(this._runnable, true);};thi$.stop = function () {if (this._worker.terminate) {this._worker.terminate();} else {}};thi$._init = function (Runnable) {this._runnable = Runnable || {context:{}, run:function () {J$VM.System.out.println("Web Worker is running");}};var path = J$VM.env["j$vm_home"] + "/classes/js/util/";if (self.Worker) {this._worker = new Worker(path + "Worker.jz");} else {var iframe = document.createElement("iframe");iframe.style.cssText = "visibility:hidden;border:0;width:0;height:0;";document.body.appendChild(iframe);var text = new js.lang.StringBuffer();text = text.append("<html><head>").append("<meta http-equiv='X-UA-Compatible' content='IE=edge'>").append("<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>").append("</head></html>").toString();var doc = iframe.contentWindow.document, head, script;doc.open();doc.write(text);doc.close();head = doc.getElementsByTagName("head")[0];text = Class.getResource(J$VM.env["j$vm_home"] + "/jsre.js");script = doc.createElement("script");script.type = "text/javascript";script.id = "j$vm";script.setAttribute("crs", J$VM.env["j$vm_home"] + "/jsre.js");script.setAttribute("classpath", "");script.text = text;text = Class.getResource(path + "Worker.jz");script.text += text;head.appendChild(script);head.removeChild(script);this._worker = iframe.contentWindow;}Event.attachEvent(this._worker, Event.W3C_EVT_MESSAGE, 0, this, _onmessage);Event.attachEvent(this._worker, Event.W3C_EVT_ERROR, 0, this, _onerror);};this._init.apply(this, arguments);}.$extend(js.lang.Object);(function () {js.lang.Object.$decorate(this);var ua = navigator.userAgent.toLowerCase(), s;var b = (s = ua.match(/msie ([\d.]+)/)) ? this.ie = s[1] : (s = ua.match(/firefox\/([\d.]+)/)) ? this.firefox = s[1] : (s = ua.match(/chrome\/([\d.]+)/)) ? this.chrome = s[1] : (s = ua.match(/opera.([\d.]+)/)) ? this.opera = s[1] : (s = ua.match(/version\/([\d.]+).*safari/)) ? this.safari = s[1] : 0;this.secure = /^https/i.test(location.protocol);var env = this.env, uri = new js.net.URI(location.href), params = uri.params, value, tmp, p;env["uri"] = uri;for (p in params) {if (p.indexOf("j$vm_") == 0) {value = params[p], tmp = parseInt(value);value = isNaN(tmp) ? (value === "true" ? true : (value === "false" ? false : value)) : tmp;env[p] = value;}}this.System = new js.lang.System(env, this);$postMessage = J$VM.MQ.post;$sendMessage = J$VM.MQ.send;var home = env.j$vm_home, file, libs = env.j$vm_classpath ? env.j$vm_classpath.split(";") : [];if (self.JSON == undefined) {libs.unshift("lib/json2.js");}(function (file) {if (file.length === 0) {return;}if ("lib/json2.js" == file) {this.Class.loadScript(home + "/" + file);} else {this.Class.loadClass(home + "/" + file);}}).$forEach(this, libs);}).call(self.J$VM);$package("js.text");$import("js.text.Format");$import("js.util.LinkedList");js.text.SimpleDateFormat = function (pattern, DateFormatSymbols) {var CLASS = js.text.SimpleDateFormat, thi$ = CLASS.prototype;if (CLASS.__defined__) {this._init.apply(this, arguments);return;}CLASS.__defined__ = true;var Class = js.lang.Class, System = J$VM.System;var TOKEN = /yy(?:yy)?|M{1,}|d{1,2}|E{1,}|([Hhms])\1?|S(?:SS)?|[azZG]|"[^"]*"|'[^']*'/g;var Regx = {yy:"(\\d{2})", yyyy:"(\\d{4})", G:"(\\S+)", M:"([1-9]|1[012])", MM:"(0[1-9]|1[012])", MMM:"(\\S+)", MMMM:"(\\S+)", d:"([1-9]|[12][0-9]|3[01])", dd:"(0[1-9]|[12][0-9]|3[01])", E:"(\\S+)", EE:"(\\S+)", EEE:"(\\S+)", EEEE:"(\\S+)", H:"([0-9]|1[0-9]|2[0-3])", HH:"(0[0-9]|1[0-9]|2[0-3])", h:"([1-9]|1[012])", hh:"(0[1-9]|1[012])", a:"(\\S+)", m:"([0-9]|[1-5][0-9])", mm:"([0-5][0-9])", s:"([0-9]|[1-5][0-9])", ss:"([0-5][0-9])", S:"(\\d{1,3})", SSS:"(\\d{3})", z:"(\\S+)", Z:"([\\-\\+]\\d{2,4})"};var Getter = new function () {var _pad = function (val, len) {val = "000" + String(val);return val.slice(val.length - (len || 2));};var _week = function (D, $, b) {return b ? D.getUTCDay() : D.getDay();};this.yy = function (D, $, b) {return _pad(this.yyyy(D, $, b), 2);};this.yyyy = function (D, $, b) {return _pad((b ? D.getUTCFullYear() : D.getFullYear()), 4);};this.M = function (D, $, b) {return (b ? D.getUTCMonth() : D.getMonth()) + 1;};this.MM = function (D, $, b) {return _pad(this.M(D, $, b), 2);};this.MMM = function (D, $, b) {return $.getShortMonths()[this.M(D, $, b) - 1];};this.MMMM = function (D, $, b) {return $.getMonths()[this.M(D, $, b) - 1];};this.d = function (D, $, b) {return b ? D.getUTCDate() : D.getDate();};this.dd = function (D, $, b) {return _pad(this.d(D, $, b), 2);};this.E = function (D, $, b) {return $.getShortWeekdays()[_week(D, $, b)];};this.EE = function (D, $, b) {return $.getShortWeekdays()[_week(D, $, b)];};this.EEE = function (D, $, b) {return $.getShortWeekdays()[_week(D, $, b)];};this.EEEE = function (D, $, b) {return $.getWeekdays()[_week(D, $, b)];};this.H = function (D, $, b) {return b ? D.getUTCHours() : D.getHours();};this.HH = function (D, $, b) {return _pad(this.H(D, $, b), 2);};this.h = function (D, $, b) {return this.H(D, $, b) % 12 || 12;};this.hh = function (D, $, b) {return _pad(this.h(D, $, b), 2);};this.m = function (D, $, b) {return b ? D.getUTCMinutes() : D.getMinutes();};this.mm = function (D, $, b) {return _pad(this.m(D, $, b), 2);};this.s = function (D, $, b) {return b ? D.getUTCSeconds() : D.getSeconds();};this.ss = function (D, $, b) {return _pad(this.s(D, $, b));};this.S = function (D, $, b) {return b ? D.getUTCMilliseconds() : D.getMilliseconds();};this.SSS = function (D, $, b) {return _pad(this.S(D, $, b), 3);};this.a = function (D, $, b) {return $.getAmPmStrings()[this.H(D, $, b) < 12 ? 0 : 1];};this.G = function (D, $, b) {return $.getEras()[parseInt(this.yyyy(D, $, b), 10) < 0 ? 0 : 1];};this.z = function (D, $, b) {return b ? "UTC" : (String(D).match(js.text.SimpleDateFormat.TIMEZONE) || [""]).pop().replace(/[^-+\dA-Z]/g, "");};this.Z = function (D, $, b) {var o = D.getTimezoneOffset(), ao = Math.abs(o);return (o > 0 ? "-" : "+") + _pad(Math.floor(ao / 60) * 100 + ao % 60, 4);};}();var Setter = new function () {this.yy = function (D, v, $, b) {return this.yyyy(D, v, $, b);};this.yyyy = function (D, v, $, b) {var y = parseInt(v, 10);D.y = (y > 0 && D.bc) ? 0 - y : y;b ? D.setUTCFullYear(D.y) : D.setFullYear(D.y);return D;};this.M = function (D, v, $, b) {var M = parseInt(v, 10) - 1;b ? D.setUTCMonth(M) : D.setMonth(M);return D;};this.MM = function (D, v, $, b) {return this.M(D, v, $, b);};this.MMM = function (D, v, $, b) {var i = $.getShortMonths().indexOf(v);return i != -1 ? this.M(D, i + 1, $, b) : D;};this.MMMM = function (D, v, $, b) {var i = $.getMonths().indexOf(v);return i != -1 ? this.M(D, i + 1, $, b) : D;};this.d = function (D, v, $, b) {var d = parseInt(v, 10);b ? D.setUTCDate(d) : D.setDate(d);return D;};this.dd = function (D, v, $, b) {return this.d(D, v, $, b);};this.E = function (D, v, $, b) {return D;};this.EE = function (D, v, $, b) {return D;};this.EEE = function (D, v, $, b) {return D;};this.EEEE = function (D, v, $, b) {return D;};this.H = function (D, v, $, b) {var h = parseInt(v, 10);D.h = (h < 12 && D.pm) ? (h + 12) % 24 : h;b ? D.setUTCHours(D.h) : D.setHours(D.h);return D;};this.HH = function (D, v, $, b) {return this.H(D, v, $, b);};this.h = function (D, v, $, b) {return this.H(D, v, $, b);};this.hh = function (D, v, $, b) {return this.H(D, v, $, b);};this.m = function (D, v, $, b) {var m = parseInt(v, 10);b ? D.setUTCMinutes(m) : D.setMinutes(m);return D;};this.mm = function (D, v, $, b) {return this.m(D, v, $, b);};this.s = function (D, v, $, b) {var s = parseInt(v, 10);b ? D.setUTCSeconds(s) : D.setSeconds(s);return D;};this.ss = function (D, v, $, b) {return this.s(D, v, $, b);};this.S = function (D, v, $, b) {var S = parseInt(v, 10);b ? D.setUTCMilliseconds(S) : D.setMilliseconds(S);return D;};this.SSS = function (D, v, $, b) {return this.S(D, v, $, b);};this.a = function (D, v, $, b) {switch ($.getAmPmStrings().indexOf(v)) {case 0:D.am = true;return (D.h && D.h == 12) ? this.H(D, 0, $, b) : D;case 1:D.pm = true;return D.h ? this.H(D, D.h, $, b) : D;}return D;}, this.G = function (D, v, $, b) {if ($.getEras().indexOf(v) === 0) {D.bc = true;return D.y ? this.yyyy(D, D.y, $, b) : D;}return D;};this.z = function (D, v, $, b) {return D;};this.Z = function (D, v, $, b) {return D;};}();thi$.setPattern = function (pattern) {pattern = this.pattern = pattern || "EEE MMM dd HH:mm:ss yyyy";CLASS.infos = CLASS.infos || {};var info = CLASS.infos[pattern];if (info) {return;}info = CLASS.infos[pattern] = {};var pIndex = info.pIndex = js.util.LinkedList.newInstance();var str = pattern.replace(TOKEN, function ($0) {var t = $0.charAt(0);$0 = ((t == "M" || t == "E") && $0.length > 4) ? $0.slice(0, 4) : $0;if (typeof Setter[$0] === "function") {pIndex.push($0);return Regx[$0];}return $0;});info.dPattern = new RegExp(str);}.$override(this.setPattern);thi$.setDateFormatSymbols = function (DateFormatSymbols) {this.symbols = DateFormatSymbols || new (Class.forName("js.text.DateFormatSymbols"))();};thi$.setSymbols = function (symbols) {this.symbols = symbols || new (Class.forName("js.text.DateFormatSymbols"))();}.$override(this.setSymbols);thi$.format = function (date, isUTC) {date = date ? date : new Date();if (!Class.isDate(date)) {throw SyntaxError("Invalid date");}var _symbols = this.symbols;return this.pattern.replace(TOKEN, function ($0) {var t = $0.charAt(0);$0 = ((t == "M" || t == "E") && $0.length > 4) ? $0.slice(0, 4) : $0;return (typeof Getter[$0] === "function") ? Getter[$0](date, _symbols, isUTC) : $0.slice(1, $0.length - 1);});}.$override(this.format);thi$.parse = function (datestr, isUTC) {var info = CLASS.infos[this.pattern], pIndex = info.pIndex, _symbols = this.symbols, date, m = datestr.match(info.dPattern), $0;if (m) {date = new Date(0);for (var i = 1, len = m.length; i < len; i++) {$0 = pIndex[i - 1];date = Setter[$0](date, m[i], _symbols, isUTC);}return date;}try {date = new Date(Date.parse(datestr));}catch (x) {}if (!Class.isDate(date)) {throw SyntaxError("Invalid date string");}return date;}.$override(this.parse);this._init.apply(this, arguments);}.$extend(js.text.Format);if (Date.SF === undefined) {Date.SF = new js.text.SimpleDateFormat();Date.prototype.$format = function (pattern, isUTC) {if (pattern) {Date.SF.setPattern(pattern);}return Date.SF.format(this, isUTC);};Date.$parse = function (datestr, pattern, symbols, isUTC) {if (pattern) {Date.SF.setPattern(pattern);}if (symbols) {Date.SF.setSymbols(symbols);}return Date.SF.parse(datestr, isUTC);};}