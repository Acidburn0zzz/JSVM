js.lang.Class = new function () {var _modules = {};this.definePackage = function (packageName) {if (_modules[packageName]) {return;}var names = packageName.split(".");var parent = self;for (var i = 0, len = names.length; i < len; i++) {var name = names[i];if (parent[name] === undefined) {parent[name] = {};}parent = parent[name];}_modules[packageName] = parent;};this.importClass = function (className) {var clazz = _checkClass(className);if (clazz != undefined) {return clazz;}var buf = [];buf.push(J$VM.env.j$vm_home);buf.push("/classes");var names = className.split(".");for (var i = 0, len = names.length; i < len; i++) {buf.push("/");buf.push(names[i]);}buf.push(".jz");var filePath = buf.join("");try {_loadClass(filePath, className);clazz = _modules[className] = _checkClass(className);}catch (ex) {J$VM.System.err.println("Can't load " + className + " from " + filePath);}return clazz;};var _checkClass = function (className) {var clazz = _modules[className];if (clazz === undefined) {var names = className.split(".");clazz = self;for (var i = 0, len = names.length; i < len; i++) {var name = names[i];if (clazz[name] === undefined) {clazz = undefined;break;}clazz = clazz[name];}_modules[className] = clazz;}return clazz;}.$bind(this);this.loadClass = function (filePath) {try {_loadClass(filePath);}catch (ex) {J$VM.System.err.println("Can't load class from " + filePath);}};var _loadClass = function (filePath, className) {if (!J$VM.env.j$vm_isworker) {var storage = J$VM.storage.local, text, incache = false, cached = storage.getItem(className || filePath);if (cached) {if (cached.build === J$VM.__version__) {text = cached.text;incache = true;}}text = text || this.getResource(filePath);this.loadScript(filePath, text);if (!incache) {try {storage.setItem(className || filePath, {build:J$VM.__version__, text:text});}catch (x) {J$VM.System.err.println(x);}}} else {importScripts(filePath);}}.$bind(this);this.loadScript = function (filePath, text) {text = text || this.getResource(filePath);var script = document.createElement("script");var head = document.getElementsByTagName("head")[0];script.type = "text/javascript";script.text = text;head.appendChild(script);head.removeChild(script);}.$bind(this);this.getResource = function (url) {var xhr = new js.net.HttpURLConnection(false);xhr.open("GET", url);if (xhr.exception == undefined && xhr.readyState() == 4 && (xhr.status() == 200 || xhr.status() == 304)) {var text = xhr.responseText();xhr.close();return text;}var ex = xhr.exception;xhr.close();throw ex;}.$bind(this);this.forName = function (className) {var clazz = _checkClass(className);if (clazz === undefined) {clazz = this.importClass(className);}return clazz;}.$bind(this);this.typeOf = function (o) {return (o === null) ? "null" : (o === undefined) ? "undefined" : this.isHtmlElement(o) ? "html" + o.tagName.toLowerCase() + "element" : (function () {var s = Object.prototype.toString.call(o);return s.substring(8, s.length - 1).toLowerCase();})();}.$bind(this);this.isDate = function (o) {return (this.typeOf(o) == "date" && !isNaN(o));};this.isArray = function (o) {return this.typeOf(o) === "array";};this.isString = function (o) {return this.typeOf(o) == "string";};this.isNumber = function (o) {return !isNaN(o) && this.typeOf(o) == "number";};this.isObject = function (o) {return this.typeOf(o) == "object";};this.isBoolean = function (o) {return this.typeOf(o) == "boolean";};this.isNull = function (o) {return this.typeOf(o) == "null";};this.isUndefined = function (o) {return this.typeOf(o) == "undefined";};this.isFunction = function (o) {return this.typeOf(o) == "function";};this.isValid = function (o) {return (o != null) && (o != undefined);};this.isHtmlElement = function (o) {return o ? !!o.tagName : false;};this.isJSON = function (str) {if (!this.isString(str) || str.length == 0) {return false;}try {var obj = JSON.parse(str);return true;}catch (e) {return false;}};this.is = function (o, type) {if (!type) {return o !== undefined && o !== null;}var b = false;type = type.toLowerCase();switch (type) {case "number":b = this.isNumber(o);break;case "date":b = this.isDate(o);break;default:b = (this.typeOf(o) === type);break;}return b;};}();$package = js.lang.Class.definePackage;$import = js.lang.Class.importClass;